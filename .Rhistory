## Test
load("./Objs/FinalClassifiers.rda")
ClassifierGenes <- as.vector(ArrayKTSP$TSPs)
ktspStatsGSE89146 <- SWAP.KTSP.Statistics(
inputMat = Expr_Filt,
classifier = ArrayKTSP,
CombineFunc = sum)
summary(ktspStatsGSE89146$statistics)
### Print ROC curve local maximas
auc(roc(Pheno$NodeStatus, ktspStatsGSE89146$statistics, levels=c("POS", "NEG"),
direction="<"))
GSE89146Prediction <- SWAP.KTSP.Classify(
Expr_Filt,
ArrayKTSP,
DecisionFunc = function(x) sum(x) > 2.5 )
Pheno$NodeStatus <- factor(Pheno$NodeStatus, levels = c("POS", "NEG"))
table(Pheno$NodeStatus)
### Resubstitution performance in the TRAINING set
confusionMatrix(GSE89146Prediction, Pheno$NodeStatus, positive="POS")
View(Pheno)
mean(Pheno$`age:ch1`)
mean(as.numeric(Pheno$`age:ch1`))
# All are T1, T2
Pheno$T_stage <- Pheno$`Stage:ch1`
Pheno$T_stage <- gsub("N.+", "", Pheno$T_stage)
table(Pheno$T_stage)
rm(list = ls())
?sweep
library(ggplot2)
library(switchBox)
library(superheat)
library(reshape2)
library(pROC)
## Load the 2 classifiers and data
load("./Objs/FinalClassifiers.rda")
############################################################################
## Scatter Plots
###########################################################################
### Plot genes in the training set (the 2 array datsets)
## Which TSPs
i <- 1:nrow(ArrayKTSP$TSPs)
ktspStatsArray <- SWAP.KTSP.Statistics(
inputMat = ArrayMat,
classifier = ArrayKTSP,
CombineFunc = sum)
Array_Stats <- ktspStatsArray$comparisons
Array_Stats <- Array_Stats*1
# Order the stats by the sum of votes
NewOrder <- order(rowSums(Array_Stats))
Array_Stats <- Array_Stats[NewOrder, ]
#GroupCol <- ArrayGroup[NewOrder]
#levels(GroupCol) <- c("red", "blue")
# Order the true class labels
ArrayGroup <- ArrayGroup[NewOrder]
# Get the predicted class labels
PredClass <- ifelse(rowSums(Array_Stats) >= 3, "NEG", "POS")
PredClass <- factor(PredClass, levels = c("POS", "NEG"))
levels(PredClass) <- c("red", "blue")
# Check order
all(rownames(Array_Stats) == names(PredClass)) # TRUE:: No Need to order them (Already ordered by sum of votes)
# Plot
?pdf
pdf("./Figs/Heatmaps/ArrayKTSP_Heatmap.pdf", width = 10, height = 8)
pdf("./Figs/Heatmaps/ArrayKTSP_Heatmap.pdf", width = 10, height = 8)
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 3.5, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the array dataset")
dev.off()
pdf("./Figs/Heatmaps/ArrayKTSP_Heatmap.pdf", width = 12, height = 8)
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 3.5, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the array dataset")
dev.off()
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 3, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the array dataset")
pdf("./Figs/Heatmaps/ArrayKTSP_Heatmap.pdf", width = 12, height = 8)
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 3, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the array dataset")
dev.off()
graphics.off()
pdf("./Figs/Heatmaps/SuppFigure2.pdf", width = 12, height = 8)
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 3, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
dev.off()
pdf("./Figs/Heatmaps/SuppFigure2.pdf", width = 10, height = 9)
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
dev.off()
pdf("./Figs/Heatmaps/SuppFigure2.pdf", width = 10, height = 9, onefile = F)
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
dev.off()
?superheat
pdf("./Figs/Heatmaps/SuppFigure2.pdf", width = 10, height = 9, onefile = F, colormodel)
pdf("./Figs/Heatmaps/SuppFigure2.pdf", width = 10, height = 9, onefile = F, colormodel = 'cmyk')
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
dev.off()
pdf("./Figs/Heatmaps/SuppFigure2.pdf", width = 10, height = 9, onefile = F, bg = 'gray')
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
dev.off()
pdf("./Figs/Heatmaps/SuppFigure2.pdf", width = 10, height = 9, onefile = F, bg = 'white')
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
dev.off()
pdf("./Figs/Heatmaps/SuppFigure2.pdf", width = 10, height = 9, onefile = F)
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
dev.off()
ktspStatsArray <- SWAP.KTSP.Statistics(
inputMat = ArrayMat,
classifier = ArrayKTSP,
CombineFunc = sum)
Array_Stats <- ktspStatsArray$comparisons
Array_Stats <- Array_Stats*1
View(Array_Stats)
View(Array_Stats)
Array_Stats <- apply(Array_Stats, 2, as.character)
Array_Stats <- ktspStatsArray$comparisons
Array_Stats <- Array_Stats*1
Array_Stats <- apply(Array_Stats, 1, as.character)
?apply
Array_Stats <- ktspStatsArray$comparisons
Array_Stats <- Array_Stats*1
Samples <- rownames(Array_Stats)
View(Array_Stats)
Array_Stats <- apply(Array_Stats, 2, as.character)
rownames(Array_Stats) <- Samples
# Order the stats by the sum of votes
NewOrder <- order(rowSums(Array_Stats))
Array_Stats <- ktspStatsArray$comparisons
Array_Stats <- Array_Stats*1
# Order the stats by the sum of votes
NewOrder <- order(rowSums(Array_Stats))
Array_Stats <- Array_Stats[NewOrder, ]
Samples <- rownames(Array_Stats)
Array_Stats <- apply(Array_Stats, 2, as.character)
rownames(Array_Stats) <- Samples
# Order the true class labels
ArrayGroup <- ArrayGroup[NewOrder]
# Get the predicted class labels
PredClass <- ifelse(rowSums(Array_Stats) >= 3, "NEG", "POS")
Array_Stats <- ktspStatsArray$comparisons
Array_Stats <- Array_Stats*1
# Order the stats by the sum of votes
NewOrder <- order(rowSums(Array_Stats))
Array_Stats <- Array_Stats[NewOrder, ]
# Order the true class labels
ArrayGroup <- ArrayGroup[NewOrder]
# Get the predicted class labels
PredClass <- ifelse(rowSums(Array_Stats) >= 3, "NEG", "POS")
PredClass <- factor(PredClass, levels = c("POS", "NEG"))
levels(PredClass) <- c("red", "blue")
# Check order
all(rownames(Array_Stats) == names(PredClass)) # TRUE:: No Need to order them (Already ordered by sum of votes)
Samples <- rownames(Array_Stats)
Array_Stats <- apply(Array_Stats, 2, as.character)
rownames(Array_Stats) <- Samples
superheat(Array_Stats, col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
superheat(as.numeric(Array_Stats), col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
superheat(apply(Array_Stats, 2, as.numeric), col.dendrogram = F, yr = rowSums(Array_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = ArrayGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap of the TSPs votes in the array dataset")
ktspStatsTCGA <- SWAP.KTSP.Statistics(
inputMat = tcgaMat,
classifier = tcgaKTSP,
CombineFunc = sum)
TCGA_Stats <- ktspStatsTCGA$comparisons
TCGA_Stats <- TCGA_Stats*1
# Order the stats by the sum of votes
NewOrder <- order(rowSums(TCGA_Stats))
TCGA_Stats <- TCGA_Stats[NewOrder, ]
# Order the true class labels
tcgaGroup <- tcgaGroup[NewOrder]
# Get the predicted class labels
PredClass <- ifelse(rowSums(TCGA_Stats) >= 3, "NEG", "POS")
PredClass <- factor(PredClass, levels = c("POS", "NEG"))
#X <- X[NewOrder]
levels(PredClass) <- c("red", "blue")
# Check order
all(rownames(TCGA_Stats) == names(PredClass)) # TRUE:: No Need to order them (Already ordered by sum of votes)
pdf("./Figs/Heatmaps/SuppFigure3.pdf", width = 10, height = 9, onefile = F)
superheat(TCGA_Stats, col.dendrogram = F, yr = rowSums(TCGA_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = tcgaGroup, bottom.label.text.size = 3.5, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the TCGA dataset")
dev.off()
pdf("./Figs/Heatmaps/SuppFigure3.pdf", width = 10, height = 9, onefile = F)
superheat(TCGA_Stats, col.dendrogram = F, yr = rowSums(TCGA_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = tcgaGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the TCGA dataset")
dev.off()
pcrData <- read.delim("./Data/RT_PCR/deltaCt.txt")
# Get the node status
pcrGroup <- pcrData$NodeStatus
table(pcrGroup)
# Rename the groups from 0,1 to neg,pos
pcrGroup[pcrGroup == 0] <- "NEG"
pcrGroup[pcrGroup == 1] <- "POS"
pcrGroup <- factor(pcrGroup, levels = c("POS", "NEG"))
pcrMat <- pcrData[, -14]
rownames(pcrMat) <- pcrMat$SampleName
pcrMat$SampleName <- NULL
# Transpose the matrix
pcrMat <- t(pcrMat)
# One gene is misspelled, rename it
rownames(pcrMat)[rownames(pcrMat) == "TFGB2"] <- "TGFB2"
# Get the prediction stats
ktspStatsPCR <- SWAP.KTSP.Statistics(
inputMat = pcrMat,
classifier = tcgaKTSP,
CombineFunc = sum)
PCR_Stats <- ktspStatsPCR$comparisons
PCR_Stats <- PCR_Stats*1
# Order the stats by the sum of votes
NewOrder <- order(rowSums(PCR_Stats))
PCR_Stats <- PCR_Stats[NewOrder, ]
# Order the true class labels
pcrGroup <- pcrGroup[NewOrder]
# Get the predicted class labels
PredClass <- ifelse(rowSums(PCR_Stats) >= 3, "NEG", "POS")
PredClass <- factor(PredClass, levels = c("POS", "NEG"))
#X <- X[NewOrder]
levels(PredClass) <- c("red", "blue")
# Check order
all(rownames(PCR_Stats) == names(PredClass)) # TRUE:: No Need to order them (Already ordered by sum of votes)
pdf("./Figs/Heatmaps/Figure1.pdf", width = 10, height = 9, onefile = F)
superheat(PCR_Stats, col.dendrogram = F, yr = rowSums(PCR_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = pcrGroup, bottom.label.text.size = 2, yr.num.ticks = 6, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the PCR (Testing) dataset")
dev.off()
superheat(PCR_Stats, col.dendrogram = F, yr = rowSums(PCR_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = pcrGroup, bottom.label.text.size = 2, yr.num.ticks = 4, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the PCR (Testing) dataset")
pdf("./Figs/Heatmaps/Figure1.pdf", width = 10, height = 9, onefile = F)
superheat(PCR_Stats, col.dendrogram = F, yr = rowSums(PCR_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = pcrGroup, bottom.label.text.size = 2, yr.num.ticks = 4, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the PCR (Testing) dataset")
dev.off()
?pdf
pdf("./Figs/Heatmaps/Figure1.pdf", width = 10, height = 9, onefile = F, colormodel = 'srgb+gray')
superheat(PCR_Stats, col.dendrogram = F, yr = rowSums(PCR_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = pcrGroup, bottom.label.text.size = 2, yr.num.ticks = 4, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the PCR (Testing) dataset")
dev.off()
pdf("./Figs/Heatmaps/Figure1.pdf", width = 10, height = 9, onefile = F, colormodel = 'rgb')
superheat(PCR_Stats, col.dendrogram = F, yr = rowSums(PCR_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = pcrGroup, bottom.label.text.size = 2, yr.num.ticks = 4, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the PCR (Testing) dataset")
dev.off()
pdf("./Figs/Heatmaps/Figure1.pdf", width = 10, height = 9, onefile = F)
superheat(PCR_Stats, col.dendrogram = F, yr = rowSums(PCR_Stats), yr.plot.type  = "bar", left.label.text.col = c("red", "blue"), membership.rows = pcrGroup, bottom.label.text.size = 2, yr.num.ticks = 4, yr.axis.name	= "Sum of votes", yr.obs.col = PredClass, title = "Heatmap for the TSPs votes in the PCR (Testing) dataset")
dev.off()
datArray_KTSP <- melt(data.frame(
## Training Group
ArrayGroup= factor(ArrayGroup, levels = c("NEG", "POS")),
## Mechanistic KTSP SUM training
ktspStatsArray= ktspStatsArray$statistics))
### Change Colnames
colnames(datArray_KTSP) <- c("Status", "Dataset", "KTSP_sum")
datTcga_KTSP <- melt(data.frame(
## Testing group
Testing= factor(tcgaGroup, levels = c("NEG", "POS")),
## Mechanistic KTSP SUM training
ktspStatsTCGA=ktspStatsTCGA$statistics))
### Change Colnames
colnames(datTcga_KTSP) <- c("Status", "Dataset", "KTSP_sum")
### Testing
datPCR_KTSP <- melt(data.frame(
## Testing group
Testing= factor(pcrGroup, levels = c("NEG", "POS")),
## Mechanistic KTSP SUM training
ktspStatsPCR=ktspStatsPCR$statistics))
### Change Colnames
colnames(datPCR_KTSP) <- c("Status", "Dataset", "KTSP_sum")
### Combine
dat_KTSP <- rbind(datArray_KTSP, datTcga_KTSP, datPCR_KTSP)
dat_KTSP$Status <- as.numeric(dat_KTSP$Status)-1
### Replace levels
levels(dat_KTSP$Dataset) <- c("Training (Array)", "Training (TCGA)", "Testing (RT-PCR)")
levels(dat_KTSP$Dataset) <- paste(levels(dat_KTSP$Dataset), forLegend_KTSP)
rm(list = ls())
load("./Objs/FinalClassifiers.rda")
############################################################################
tspStatsArray <- SWAP.KTSP.Statistics(
inputMat = ArrayMat,
classifier = ArrayKTSP,
CombineFunc = sum)
ktspStatsTCGA <- SWAP.KTSP.Statistics(
inputMat = tcgaMat,
classifier = tcgaKTSP,
CombineFunc = sum)
ktspStatsPCR <- SWAP.KTSP.Statistics(
inputMat = pcrMat,
classifier = ArrayKTSP,
CombineFunc = sum)
### Prepare the legend
forLegend_KTSP <- apply(rbind(
ci(roc(ArrayGroup, ktspStatsArray$statistics, levels = c("NEG", "POS"), direction = ">")),
ci(roc(tcgaGroup, ktspStatsTCGA$statistics, levels = c("NEG", "POS"), direction = ">")),
ci(roc(pcrGroup, ktspStatsPCR$statistics, levels = c("NEG", "POS"), direction = ">"))
),  1, function(x) {
x <- format(round(x, digits=2), nsmall=2)
paste("AUC: ", x[[2]], ";", "95% CI: ", x[[1]], "-", x[[3]])
})
# Get the stats
ktspStatsArray <- SWAP.KTSP.Statistics(
inputMat = ArrayMat,
classifier = ArrayKTSP,
CombineFunc = sum)
ktspStatsTCGA <- SWAP.KTSP.Statistics(
inputMat = tcgaMat,
classifier = tcgaKTSP,
CombineFunc = sum)
ktspStatsPCR <- SWAP.KTSP.Statistics(
inputMat = pcrMat,
classifier = ArrayKTSP,
CombineFunc = sum)
pcrData <- read.delim("./Data/RT_PCR/deltaCt.txt")
# Get the node status
pcrGroup <- pcrData$NodeStatus
table(pcrGroup)
# Rename the groups from 0,1 to neg,pos
pcrGroup[pcrGroup == 0] <- "NEG"
pcrGroup[pcrGroup == 1] <- "POS"
pcrGroup <- factor(pcrGroup, levels = c("POS", "NEG"))
# Get the matrix
pcrMat <- pcrData[, -14]
rownames(pcrMat) <- pcrMat$SampleName
pcrMat$SampleName <- NULL
# Transpose the matrix
pcrMat <- t(pcrMat)
# One gene is misspelled, rename it
rownames(pcrMat)[rownames(pcrMat) == "TFGB2"] <- "TGFB2"
# Get the prediction stats
ktspStatsPCR <- SWAP.KTSP.Statistics(
inputMat = pcrMat,
classifier = tcgaKTSP,
CombineFunc = sum)
PCR_Stats <- ktspStatsPCR$comparisons
PCR_Stats <- PCR_Stats*1
# Order the stats by the sum of votes
NewOrder <- order(rowSums(PCR_Stats))
PCR_Stats <- PCR_Stat
PCR_Stats <- PCR_Stats[NewOrder, ]
# Order the true class labels
pcrGroup <- pcrGroup[NewOrder]
PredClass <- ifelse(rowSums(PCR_Stats) >= 3, "NEG", "POS")
PredClass <- factor(PredClass, levels = c("POS", "NEG"))
#X <- X[NewOrder]
levels(PredClass) <- c("red", "blue")
# Check order
all(rownames(PCR_Stats) == names(PredClass)) # TRUE:: No Need to order them (Already ordered by sum of votes)
ktspStatsArray <- SWAP.KTSP.Statistics(
inputMat = ArrayMat,
classifier = ArrayKTSP,
CombineFunc = sum)
ktspStatsTCGA <- SWAP.KTSP.Statistics(
inputMat = tcgaMat,
classifier = tcgaKTSP,
CombineFunc = sum)
ktspStatsPCR <- SWAP.KTSP.Statistics(
inputMat = pcrMat,
classifier = ArrayKTSP,
CombineFunc = sum)
### Prepare the legend
forLegend_KTSP <- apply(rbind(
ci(roc(ArrayGroup, ktspStatsArray$statistics, levels = c("NEG", "POS"), direction = ">")),
ci(roc(tcgaGroup, ktspStatsTCGA$statistics, levels = c("NEG", "POS"), direction = ">")),
ci(roc(pcrGroup, ktspStatsPCR$statistics, levels = c("NEG", "POS"), direction = ">"))
),  1, function(x) {
x <- format(round(x, digits=2), nsmall=2)
paste("AUC: ", x[[2]], ";", "95% CI: ", x[[1]], "-", x[[3]])
})
datArray_KTSP <- melt(data.frame(
## Training Group
ArrayGroup= factor(ArrayGroup, levels = c("NEG", "POS")),
## Mechanistic KTSP SUM training
ktspStatsArray= ktspStatsArray$statistics))
### Change Colnames
colnames(datArray_KTSP) <- c("Status", "Dataset", "KTSP_sum")
### Testing
datTcga_KTSP <- melt(data.frame(
## Testing group
Testing= factor(tcgaGroup, levels = c("NEG", "POS")),
## Mechanistic KTSP SUM training
ktspStatsTCGA=ktspStatsTCGA$statistics))
### Change Colnames
colnames(datTcga_KTSP) <- c("Status", "Dataset", "KTSP_sum")
### Testing
datPCR_KTSP <- melt(data.frame(
## Testing group
Testing= factor(pcrGroup, levels = c("NEG", "POS")),
## Mechanistic KTSP SUM training
ktspStatsPCR=ktspStatsPCR$statistics))
### Change Colnames
colnames(datPCR_KTSP) <- c("Status", "Dataset", "KTSP_sum")
### Combine
dat_KTSP <- rbind(datArray_KTSP, datTcga_KTSP, datPCR_KTSP)
dat_KTSP$Status <- as.numeric(dat_KTSP$Status)-1
### Replace levels
levels(dat_KTSP$Dataset) <- c("Training (Array)", "Training (TCGA)", "Testing (RT-PCR)")
levels(dat_KTSP$Dataset) <- paste(levels(dat_KTSP$Dataset), forLegend_KTSP)
myCol <- brewer.pal(3, "Dark2")[c(2,1)]
### Plot and legend titles
plotTitle <- "K-TSP Performance in the training and testing datasets"
#legendTitle <- "Dataset"
### Plot
basicplot_KTSP <- ggplot(dat_KTSP, aes(d=Status, m=KTSP_sum, color=Dataset,
linetype = Dataset)) +
geom_roc(increasing = F) +
style_roc(theme = theme_grey) + ggtitle(plotTitle) +
theme(plot.title = element_text(face="bold", size=16, hjust = 0.5),
axis.text=element_text(face="plain", size = 11),
axis.title=element_text(face="bold", size = 13),
legend.justification=c(1,0),  legend.position=c(1,0),
legend.background=element_rect(fill="lightblue1"),
legend.text=element_text(face="plain", size = 10),
legend.title = element_text(face="bold", size=12)) +
scale_color_manual(values = c("darkred", "darkred", "darkblue")) +
#scale_color_manual(legendTitle, values=rep(myCol, 2)) +
scale_linetype_manual(values=c("solid", "solid", "solid")) +
guides(colour = guide_legend(override.aes = list(size=3)))
### Plot
basicplot_KTSP
library(ggplot2)
library(pROC)
??geom_roc
library(plotROC)
#legendTitle <- "Dataset"
### Plot
basicplot_KTSP <- ggplot(dat_KTSP, aes(d=Status, m=KTSP_sum, color=Dataset,
linetype = Dataset)) +
geom_roc(increasing = F) +
style_roc(theme = theme_grey) + ggtitle(plotTitle) +
theme(plot.title = element_text(face="bold", size=16, hjust = 0.5),
axis.text=element_text(face="plain", size = 11),
axis.title=element_text(face="bold", size = 13),
legend.justification=c(1,0),  legend.position=c(1,0),
legend.background=element_rect(fill="lightblue1"),
legend.text=element_text(face="plain", size = 10),
legend.title = element_text(face="bold", size=12)) +
scale_color_manual(values = c("darkred", "darkred", "darkblue")) +
#scale_color_manual(legendTitle, values=rep(myCol, 2)) +
scale_linetype_manual(values=c("solid", "solid", "solid")) +
guides(colour = guide_legend(override.aes = list(size=3)))
### Plot
basicplot_KTSP
########
## 3- PCR
# Load the RT-PCR data
pcrData <- read.delim("./Data/RT_PCR/deltaCt.txt")
# Get the node status
pcrGroup <- pcrData$NodeStatus
table(pcrGroup)
# Rename the groups from 0,1 to neg,pos
pcrGroup[pcrGroup == 0] <- "NEG"
pcrGroup[pcrGroup == 1] <- "POS"
pcrGroup <- factor(pcrGroup, levels = c("POS", "NEG"))
pcrMat <- pcrData[, -14]
rownames(pcrMat) <- pcrMat$SampleName
pcrMat$SampleName <- NULL
# Transpose the matrix
pcrMat <- t(pcrMat)
# One gene is misspelled, rename it
rownames(pcrMat)[rownames(pcrMat) == "TFGB2"] <- "TGFB2"
# Get the prediction stats
ktspStatsPCR <- SWAP.KTSP.Statistics(
inputMat = pcrMat,
classifier = tcgaKTSP,
CombineFunc = sum)
PCR_Stats <- ktspStatsPCR$comparisons
ktspStatsPCR <- SWAP.KTSP.Statistics(
inputMat = pcrMat,
classifier = ArrayKTSP,
CombineFunc = sum)
### Prepare the legend
forLegend_KTSP <- apply(rbind(
ci(roc(ArrayGroup, ktspStatsArray$statistics, levels = c("NEG", "POS"), direction = ">")),
ci(roc(tcgaGroup, ktspStatsTCGA$statistics, levels = c("NEG", "POS"), direction = ">")),
ci(roc(pcrGroup, ktspStatsPCR$statistics, levels = c("NEG", "POS"), direction = ">"))
),  1, function(x) {
x <- format(round(x, digits=2), nsmall=2)
paste("AUC: ", x[[2]], ";", "95% CI: ", x[[1]], "-", x[[3]])
})
forLegend_KTSP
datArray_KTSP <- melt(data.frame(
## Training Group
ArrayGroup= factor(ArrayGroup, levels = c("NEG", "POS")),
## Mechanistic KTSP SUM training
ktspStatsArray= ktspStatsArray$statistics))
### Change Colnames
colnames(datArray_KTSP) <- c("Status", "Dataset", "KTSP_sum")
### Testing
datTcga_KTSP <- melt(data.frame(
## Testing group
Testing= factor(tcgaGroup, levels = c("NEG", "POS")),
## Mechanistic KTSP SUM training
ktspStatsTCGA=ktspStatsTCGA$statistics))
### Change Colnames
colnames(datTcga_KTSP) <- c("Status", "Dataset", "KTSP_sum")
### Testing
datPCR_KTSP <- melt(data.frame(
## Testing group
Testing= factor(pcrGroup, levels = c("NEG", "POS")),
## Mechanistic KTSP SUM training
ktspStatsPCR=ktspStatsPCR$statistics))
### Change Colnames
colnames(datPCR_KTSP) <- c("Status", "Dataset", "KTSP_sum")
### Combine
dat_KTSP <- rbind(datArray_KTSP, datTcga_KTSP, datPCR_KTSP)
dat_KTSP$Status <- as.numeric(dat_KTSP$Status)-1
### Replace levels
levels(dat_KTSP$Dataset) <- c("Training (Array)", "Training (TCGA)", "Testing (RT-PCR)")
levels(dat_KTSP$Dataset) <- paste(levels(dat_KTSP$Dataset), forLegend_KTSP)
myCol <- brewer.pal(3, "Dark2")[c(2,1)]
### Plot and legend titles
plotTitle <- "K-TSP Performance in the training and testing datasets"
#legendTitle <- "Dataset"
### Plot
basicplot_KTSP <- ggplot(dat_KTSP, aes(d=Status, m=KTSP_sum, color=Dataset,
linetype = Dataset)) +
geom_roc(increasing = F) +
style_roc(theme = theme_grey) + ggtitle(plotTitle) +
theme(plot.title = element_text(face="bold", size=16, hjust = 0.5),
axis.text=element_text(face="plain", size = 11),
axis.title=element_text(face="bold", size = 13),
legend.justification=c(1,0),  legend.position=c(1,0),
legend.background=element_rect(fill="lightblue1"),
legend.text=element_text(face="plain", size = 10),
legend.title = element_text(face="bold", size=12)) +
scale_color_manual(values = c("darkred", "darkred", "darkblue")) +
#scale_color_manual(legendTitle, values=rep(myCol, 2)) +
scale_linetype_manual(values=c("solid", "solid", "solid")) +
guides(colour = guide_legend(override.aes = list(size=3)))
### Plot
basicplot_KTSP
### Close device
pdf("./Figs/Heatmaps/Figure2.pdf", width = 10, height = 9, onefile = F)
basicplot_KTSP
dev.off()
